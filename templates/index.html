<!DOCTYPE html>
<html>
<head>
    <title>Jobs List</title>
    <!-- Add Chosen CSS and JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
    <style>
        .chosen-container {
            display: inline-block;
            width: 300px !important;
            margin: 5px;
        }
        .chosen-container-multi .chosen-choices {
            padding: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="nav">
        <b>Home</b> | <a href="/settings">Settings</a>
    </div>
    <h1>Jobs List</h1>
    {% for job in jobs %}
    <h2>Edit Job - {{ job.name }}</h2>
    <form action="/add_job" method="post">
        <input type="hidden" name="name" value="{{ job.name }}">
        <label for="time">Time:</label>
        <input type="text" name="time" value="{{ job.time }}" required>
        <label for="weekday">Semaine:</label>
        <input type="checkbox" name="weekday" {% if job.parameters.weekday %}checked{% endif %}>
        <label for="weekend">Weekend:</label>
        <input type="checkbox" name="weekend" {% if job.parameters.weekend %}checked{% endif %}><br>

        <label for="action1">Action 1:</label>
        <select name="action1" class="chosen-select" multiple>
            {% for command in commands %}
            <option value="{{ command }}" {% if command in job.parameters.action1 %}selected{% endif %}>
                {{ command }}
            </option>
            {% endfor %}
        </select>

        <label for="delay">Delais:</label>
        <input type="number" name="delay" value="{{ job.parameters.delay }}">

        <label for="action2">Action 2:</label>
        <select name="action2" class="chosen-select" multiple>
            {% for command in commands %}
            <option value="{{ command }}" {% if command in job.parameters.action2 %}selected{% endif %}>
                {{ command }}
            </option>
            {% endfor %}
        </select><br>

        <button type="submit">Update Job</button>
        <button type="button" onclick="removeJob('{{ job.name }}')">Remove Job</button>
    </form>
    {% endfor %}

    <h2>Add New Job</h2>
    <form action="/add_job" method="post">
        <label for="name">Name:</label>
        <input type="text" name="name" required>
        <label for="time">Time:</label>
        <input type="text" name="time" required>
        <label for="weekday">Semaine:</label>
        <input type="checkbox" name="weekday">
        <label for="weekend">Weekend:</label>
        <input type="checkbox" name="weekend"><br>

        <label for="action1">Action 1:</label>
        <select name="action1" class="chosen-select" multiple>
            {% for command in commands %}
            <option value="{{ command }}">{{ command }}</option>
            {% endfor %}
        </select>

        <label for="delay">Delais:</label>
        <input type="number" name="delay">

        <label for="action2">Action 2:</label>
        <select name="action2" class="chosen-select" multiple>
            {% for command in commands %}
            <option value="{{ command }}">{{ command }}</option>
            {% endfor %}
        </select><br>

        <button type="submit">Add Job</button>
    </form>

    <script>
        function removeJob(jobName) {
            if (confirm("Are you sure you want to remove this job?")) {
                const form = document.createElement("form");
                form.method = "post";
                form.action = "/remove_job";
                const input = document.createElement("input");
                input.type = "hidden";
                input.name = "name";
                input.value = jobName;
                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
    <script>
        $(document).ready(function(){
            $(".chosen-select").chosen({
                width: "300px",
                allow_single_deselect: true,
                no_results_text: "No commands found matching",
                placeholder_text_multiple: "Select commands..."
            });
        });
    </script>
</body>
</html>
